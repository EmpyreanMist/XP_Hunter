try { !function(){function e(i){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(i)}function i(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function t(e,i){for(var t=0;t<i.length;t++){var o=i[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}if("function"!=typeof PrebidImpressionController){var r=function(){function t(){i(this,t),n(this,"storeUrl","/detroitchicago/bluemonkey.gif"),n(this,"ezPixel",null),n(this,"initDone",!1),n(this,"initRetries",20),n(this,"queue",[]),n(this,"sampleRate",10),n(this,"prebidImpressions",{}),n(this,"auctions",{}),n(this,"slotAuctions",{}),n(this,"videoAuctions",{}),n(this,"rateUUIDMemo",{}),this.init()}return o(t,[{key:"init",value:function(){var i,t,o,n,r,s=this;if("function"!=typeof(null===(i=window.__ez)||void 0===i?void 0:i.Pixel)||void 0===(null===(t=window.__ez)||void 0===t?void 0:t.dot)||"object"!==e(null===(o=window.__ez)||void 0===o?void 0:o.tf)){if(this.initRetries<=0)return;return this.initRetries--,void setTimeout((function(){s.init()}),1e3)}"true"===(null===(n=window.__ez)||void 0===n||null===(r=n.tf)||void 0===r?void 0:r.MNetS2S)&&(this.sampleRate=100),this.ezPixel=new __ez.Pixel(this.storeUrl),this.setBuilder(),this.initDone=!0,this.processQueue()}},{key:"setBuilder",value:function(){var e=this;this.ezPixel.setPixelBuilder((function(i){if(0!==e.sampleRate){var t=i.pixelData;return t.sample_multiplier=100/e.sampleRate,t}})),this.ezPixel.setFireConfig({postPixels:!0,batchSize:100})}},{key:"add",value:function(e){this.initDone?this.ezPixel.Add(e):this.queue.push(e)}},{key:"processQueue",value:function(){if(0!==this.queue.length){for(var e=0;e<this.queue.length;e++)this.add(this.queue[e]);this.queue=[]}}},{key:"recordAndFireImpressionWonEvent",value:function(e){var i,t;if(this.isVisitSampledIn()){"true"===(null===(i=window.__ez)||void 0===i||null===(t=i.tf)||void 0===t?void 0:t.MNetS2S)&&"s2s"===(null==e?void 0:e.source)&&(e.source="mnet"),e.bid_won=1;var o=null;try{o=new PrebidImpression(e,!0)}catch(e){return void console.warn("PrebidImpressionController: Invalid PrebidImpression object for bid won event, skipping.",e)}this.add(o)}}},{key:"recordAuctionEndImpressions",value:function(e){if(this.isVisitSampledIn()){var i={};this.assignFloorsToBids(e),e.bidderRequests.forEach((function(e){0!==e.bids.length&&e.bids.forEach((function(e){try{i[e.bidId]=new PrebidImpression(e,!1)}catch(e){return void console.warn("PrebidImpressionController: Invalid PrebidImpression object for bidder request, skipping.",e)}}))})),e.bidsReceived.forEach((function(e){if(i.hasOwnProperty(e.requestId))i[e.requestId].addAndTransformFields(e);else try{i[e.requestId]=new PrebidImpression(e,!0)}catch(e){return void console.warn("PrebidImpressionController: Invalid PrebidImpression object for bid received, skipping.",e)}})),this.prebidImpressions=Object.assign(this.prebidImpressions,i)}}},{key:"batchFireAll",value:function(){this.isVisitSampledIn()&&(this.batchFire(Object.values(this.prebidImpressions)),this.prebidImpressions={})}},{key:"batchFire",value:function(e){if(this.isVisitSampledIn()&&null!==e&&0!==e.length)for(var i=0;i<e.length;i++)e[i]instanceof PrebidImpression?this.add(e[i]):console.warn("PrebidImpressionController: Invalid impression object in batchFire, skipping.")}},{key:"getFloorFromBid",value:function(e){if(e&&e.params){var i;if("s2s"===e.src){var t=e.ortb2Imp;if(t&&t.ext&&t.ext.hasOwnProperty("prebid")&&t.ext.prebid.hasOwnProperty("floors")){var o=t.ext.prebid.floors;o&&o.hasOwnProperty("floor")&&(i=o.floor),o&&o.hasOwnProperty("floormin")&&(i=o.floormin)}}for(var n=0,r=["floor","bidFloor","bidfloor","reserve","floorPrice","floorprice","customFloor","kadfloor"];n<r.length;n++){var s=r[n];if(e.params.hasOwnProperty(s)){i=e.params[s];break}}if("string"==typeof i&&(i=parseFloat(i)),"number"==typeof i&&!isNaN(i))return i;if("function"==typeof e.getFloor){var a=e.getFloor();if(a&&a.floor)return a.floor}}}},{key:"assignFloorsToBids",value:function(e){if(e&&e.bidderRequests)for(var i=e.bidderRequests,t=0;t<i.length;t++)for(var o=0;o<i[t].bids.length;o++){var n=this.getFloorFromBid(i[t].bids[o]);"number"!=typeof n||isNaN(n)||(i[t].bids[o].ezFloor=n)}}},{key:"isVisitSampledIn",value:function(){var e,i=null===(e=window._ezaq)||void 0===e?void 0:e.visit_uuid;return i?this.calculateRateUUID(this.sampleRate,i):(console.warn("PrebidImpressionController: No visit UUID found, cannot sample in."),!1)}},{key:"calculateRateUUID",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if("number"!=typeof e||isNaN(e)||e<0||e>100)return console.warn("PrebidImpressionController: Invalid rate for sampling in, rate: ",e),!1;if("string"!=typeof i||0===i.length)return console.warn("PrebidImpressionController: Invalid UUID for sampling in, uuid: ",i),!1;var t=0;if(Object.hasOwn(this.rateUUIDMemo,i))t=this.rateUUIDMemo[i];else{for(var o=0;o<i.length;o++)t=(t<<5)-t+i.charCodeAt(o),t|=0;this.rateUUIDMemo[i]=t}var n=t>>>0;return n/Math.pow(2,32)<e/100}}]),t}();window.PrebidImpressionController=new r}if("function"!=typeof PrebidImpression){var s=function(){function t(e,o){var r,s;if(i(this,t),n(this,"pixelData",{}),this.addAndTransformFields(e),!this.pixelData.request_id)throw new Error("Missing required fields for PrebidImpression");if(this.setPageLevelFields(),o)return this.pixelData.is_event=!0,void(this.pixelData.bid_won=e.bid_won||0);if(null!==(r=e.mediaTypes)&&void 0!==r&&r.video)this.setVideoFields(e);else{if(null===(s=e.mediaTypes)||void 0===s||!s.banner)throw new Error("PrebidImpression: Unknown media type for impression: "+JSON.stringify(e.mediaTypes));this.setDisplayFields(e)}}return o(t,[{key:"setPageLevelFields",value:function(){var e;void 0!==window._ezaq?(this.pixelData.pageview_id=_ezaq.page_view_id,this.pixelData.domain_id=parseInt(_ezaq.domain_id),this.pixelData.form_factor_id=parseInt(_ezaq.form_factor_id),this.pixelData.ab_test_id=_ezaq.ab_test_id,this.pixelData.url=window.location.href,this.pixelData.country=_ezaq.country,this.pixelData.epoch=(new Date).getTime(),this.pixelData.has_ezids=this.checkEzids(),null!==(e=window.epbjs)&&void 0!==e&&e.SS&&this.pixelData.adapter_code&&window.epbjs.SS.hasOwnProperty(this.pixelData.adapter_code.toLowerCase())&&(this.pixelData.stat_source_id=parseInt(window.epbjs.SS[this.pixelData.adapter_code.toLowerCase()]))):console.warn("PrebidImpression: _ezaq not available")}},{key:"setVideoFields",value:function(e){var i,t,o,n,r,s,a,d,l,u,p,f,c,h,v=this;if(null!==(i=window.__ez)&&void 0!==i&&null!==(t=i.vhb)&&void 0!==t&&null!==(o=t.breaks)&&void 0!==o&&o[e.adUnitCode]?this.pixelData.impression_id=__ez.vhb.breaks[e.adUnitCode].impressionId:null!==(n=window.__ez)&&void 0!==n&&null!==(r=n.vhb)&&void 0!==r&&null!==(s=r.floatingBreaks)&&void 0!==s&&s[e.adUnitCode]&&(this.pixelData.impression_id=__ez.vhb.floatingBreaks[e.adUnitCode].impressionId),null!==(a=e.mediaTypes)&&void 0!==a&&null!==(d=a.video)&&void 0!==d&&d.context&&(this.pixelData.media_type=e.mediaTypes.video.context),"instream"==this.pixelData.media_type&&null!==(l=window.__ezInstream)&&void 0!==l&&l.prebidBidders){var m=__ezInstream.prebidBidders.filter((function(e){return e.bidder===v.pixelData.adapter_code}));m.length>0&&(this.pixelData.stat_source_id=parseInt(m[0].ssid))}if("outstream"==this.pixelData.media_type&&null!==(u=window.__ezOutstream)&&void 0!==u&&u.prebidBidders){var b=__ezOutstream.prebidBidders.filter((function(e){return e.bidder===v.pixelData.adapter_code}));b.length>0&&(this.pixelData.stat_source_id=parseInt(b[0].ssid))}null!==(p=e.mediaTypes)&&void 0!==p&&null!==(f=p.video)&&void 0!==f&&f.w&&null!==(c=e.mediaTypes)&&void 0!==c&&null!==(h=c.video)&&void 0!==h&&h.h&&(this.pixelData.request_size=e.mediaTypes.video.w+"x"+e.mediaTypes.video.h)}},{key:"setDisplayFields",value:function(e){var i,t,o,n;this.pixelData.media_type="banner",null!==(i=e.mediaTypes)&&void 0!==i&&null!==(t=i.banner)&&void 0!==t&&t.sizes&&Array.isArray(e.mediaTypes.banner.sizes)&&(this.pixelData.request_size=e.mediaTypes.banner.sizes.map((function(e){return e.join("x")})).join(",").substring(0,64));var r=this.getEzSlotTargetingForAdCode(e.adUnitCode);if("function"==typeof(null===(o=window.googletag)||void 0===o?void 0:o.pubads)&&"function"==typeof(null===(n=window.googletag)||void 0===n?void 0:n.pubads().getSlots)){var s=googletag.pubads().getSlots().filter((function(i){return i.getSlotElementId()===e.adUnitCode}))[0];s&&(r=s.getTargetingMap())}if(r){var a=r.tap||"";(a=(a+"").split("-")).length>1&&(this.pixelData.impression_id=parseInt(a[a.length-1])),r.al&&(this.pixelData.position_type=parseInt(r.al)%1e3||-1),r.alc&&(this.pixelData.refresh_count=parseInt(r.alc)||1)}}},{key:"getEzSlotTargetingForAdCode",value:function(e){if(!Array.isArray(window.ezslots_raw))return{};var i=window.ezslots_raw.filter((function(i){if(!i.tap||!i.tap.includes("-"))return!1;var t=i.tap.split("-").slice(1,-1).join("-");if(!t){if(!e.startsWith("div-gpt-ad"))return!1;var o=(t=e.replace("div-gpt-ad-","")).lastIndexOf("-");return o>0&&(t=t.substring(0,o)),t.length>0&&i.tap.startsWith(t)}return t.length>0&&e.includes(t)}));return i.length?i[0]:{}}},{key:"addAndTransformFields",value:function(e){var i,t,o,n,r=this,s={auctionId:"auction_id",bidId:"request_id",requestId:"request_id",adapterCode:"adapter_code",bidder:"adapter_code",adUnitCode:"ad_unit_code",cpm:"cpm",originalCpm:"original_cpm",timeToRespond:"time_to_respond",size:"response_size",src:"source",ezFloor:"floor"};Object.keys(e).forEach((function(i){if(s.hasOwnProperty(i)){var t=s[i];r.pixelData[t]=e[i]}})),null!==(i=e.meta)&&void 0!==i&&i.advertiserDomains&&(this.pixelData.advertiser_domains=e.meta.advertiserDomains.join(",").substring(0,1023)),e.cpm&&e.originalCpm&&e.originalCpm>0&&(this.pixelData.adjustment=e.cpm/e.originalCpm),"true"===(null===(t=window.__ez)||void 0===t||null===(o=t.tf)||void 0===o?void 0:o.MNetS2S)&&"s2s"===(null===(n=this.pixelData)||void 0===n?void 0:n.source)&&(this.pixelData.source="mnet")}},{key:"checkEzids",value:function(){return"object"===e(window.ezoicIdentity)&&"function"==typeof window.ezoicIdentity.getUID&&"function"==typeof window.ezoicIdentity.isInternalUIDSource&&null!==window.ezoicIdentity.getUID()&&window.ezoicIdentity.isInternalUIDSource()?1:0}}]),t}();window.PrebidImpression=s}}();} catch(err) {var hREED = function(er) {return function() {reportEzError(er, "/detroitchicago/kenai.js")}}; typeof reportEzError==="function"?hREED(err):window.addEventListener('reportEzErrorDefined',hREED(err), {once: true}); console.error(err);}